<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
  <changeSet id="1329253443509-1" author="dellermann">
    <createTable tableName="hibernate_sequence">
      <column name="next_val" type="BIGINT"/>
    </createTable>
  </changeSet>
    
  <changeSet id="20150215-002" author="dellermann">
    <insert tableName="hibernate_sequence">
      <column name="next_val" valueNumeric="50001"/>
    </insert>
  </changeSet>
  
  <changeSet id="1329253443509-2" author="dellermann">
    <addColumn tableName="calendar_event">
      <column name="owner_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>
  
  <changeSet id="1329253443509-3" author="dellermann">
    <addColumn tableName="config">
      <!-- compose the content of the column manually -->
      <column name="value" type="VARCHAR(255)"/>
    </addColumn>
  </changeSet>
  
  <changeSet id="1329252158130-20" author="dellermann">
    <renameColumn tableName="product" oldColumnName="tax_class_id"
                  newColumnName="tax_rate_id" columnDataType="BIGINT"/>
  </changeSet>

  <changeSet id="1329252158130-21" author="dellermann">
    <renameColumn tableName="service" oldColumnName="tax_class_id"
                  newColumnName="tax_rate_id" columnDataType="BIGINT"/>
  </changeSet>

  <changeSet id="1329253443509-6" author="dellermann">
    <modifyDataType tableName="lru_entry" columnName="item_id"
                    newDataType="BIGINT"/>
  </changeSet>
  
  <changeSet id="1329253443509-7" author="dellermann">
    <modifyDataType tableName="lru_entry" columnName="pos"
                    newDataType="BIGINT"/>
  </changeSet>

  <changeSet id="1329253443509-8" author="dellermann">
    <modifyDataType tableName="phone_call" columnName="status"
                    newDataType="VARCHAR(255)"/>
  </changeSet>

  <changeSet id="1329253443509-9" author="dellermann">
    <modifyDataType tableName="phone_call" columnName="type"
                    newDataType="VARCHAR(255)"/>
  </changeSet>

  <changeSet id="1329253443509-10" author="dellermann">
    <modifyDataType tableName="product" columnName="commission"
                    newDataType="DECIMAL(19,2)"/>
  </changeSet>

  <changeSet id="1329253443509-11" author="dellermann">
    <dropNotNullConstraint tableName="product" columnName="commission"
                           columnDataType="DECIMAL(19,2)"/>
  </changeSet>
  
  <changeSet id="1329253443509-12" author="dellermann">
    <modifyDataType tableName="product" columnName="quantity"
                    newDataType="DECIMAL(19,2)"/>
  </changeSet>

  <changeSet id="1329253443509-13" author="dellermann">
    <modifyDataType tableName="product" columnName="unit_price"
                    newDataType="DECIMAL(19,2)"/>
  </changeSet>

  <changeSet id="1329253443509-14" author="dellermann">
    <modifyDataType tableName="purchase_invoice_item" columnName="description"
                    newDataType="LONGTEXT"/>
  </changeSet>

  <changeSet id="1329253443509-15" author="dellermann">
    <modifyDataType tableName="service" columnName="commission"
                    newDataType="DECIMAL(19,2)"/>
  </changeSet>
  
  <changeSet id="1329253443509-16" author="dellermann">
    <dropNotNullConstraint tableName="service" columnName="commission"
                           columnDataType="DECIMAL(19,2)"/>
  </changeSet>
  
  <changeSet id="1329253443509-17" author="dellermann">
    <modifyDataType tableName="service" columnName="quantity"
                    newDataType="DECIMAL(19,2)"/>
  </changeSet>
  
  <changeSet id="1329253443509-18" author="dellermann">
    <modifyDataType tableName="service" columnName="unit_price"
                    newDataType="DECIMAL(19,2)"/>
  </changeSet>
  
  <changeSet id="1329253443509-19" author="dellermann">
    <createIndex tableName="calendar_event" indexName="FK2A9BEA59DC0B6238"
                 unique="false">
      <column name="owner_id"/>
    </createIndex>
  </changeSet>
  
  <changeSet id="1329253443509-20" author="dellermann">
    <createIndex tableName="product" indexName="FKED8DCCEFC7AFB16B"
                 unique="false">
      <column name="tax_rate_id"/>
    </createIndex>
  </changeSet>
  
  <changeSet id="1329253443509-21" author="dellermann">
    <createIndex tableName="service" indexName="FK7643C6B5C7AFB16B"
                 unique="false">
      <column name="tax_rate_id"/>
    </createIndex>
  </changeSet>
  
  <changeSet id="20150215-001" author="dellermann">
    <insert tableName="sel_value">
      <column name="id" valueNumeric="50000"/>
      <column name="version" valueNumeric="0"/>
      <column name="name" value="Briefpost"/>
      <column name="order_id" valueNumeric="90"/>
      <column name="class" value="org.amcworld.springcrm.Carrier"/>
    </insert>
  </changeSet>
  
  <changeSet id="1329253443509-22" author="dellermann">
    <dropIndex tableName="product" indexName="FKED8DCCEF3D8CE929"/>
  </changeSet>
  
  <changeSet id="1329253443509-23" author="dellermann">
    <dropIndex tableName="service" indexName="FK7643C6B53D8CE929"/>
  </changeSet>

  <changeSet id="1329253443509-28" author="dellermann" dbms="mysql">
    <sql>
      UPDATE config SET value = IFNULL(
        boolean_value,
        IFNULL(
          date_value,
          IFNULL(
            int_value,
            string_value
          )
        )
      );
    </sql>
  </changeSet>
  
  <changeSet id="1329253443509-24" author="dellermann">
    <dropColumn tableName="config" columnName="boolean_value"/>
  </changeSet>
  
  <changeSet id="1329253443509-25" author="dellermann">
    <dropColumn tableName="config" columnName="date_value"/>
  </changeSet>
  
  <changeSet id="1329253443509-26" author="dellermann">
    <dropColumn tableName="config" columnName="int_value"/>
  </changeSet>
  
  <changeSet id="1329253443509-27" author="dellermann">
    <dropColumn tableName="config" columnName="string_value"/>
  </changeSet>
</databaseChangeLog>
