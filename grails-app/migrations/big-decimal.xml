<?xml version="1.0" encoding="UTF-8"?>

<!--

 big-decimal.xml

 Copyright (c) 2011-2016, Daniel Ellermann

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->


<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
  <changeSet author="d.ellermann@amc-world.de" id="20160120-1">
    <comment>
    Changes database columns according to migration from floating point types
    to fixed point types in Groovy.  All former double and Double types have
    been migrated to BigDecimal.  Former double values are enforced to be
    non-null and therefore are declared using &lt;addNotNullConstraint> here.

    The precision of the types are defined as follows:

    * currency values: up to 6 fraction digits; the actual precision is defined
      by a system configuration value
    * quantities: up to 6 fraction digits
    * percentage values: up to 2 fraction digits
    </comment>
  <modifyDataType tableName="invoicing_item" columnName="quantity"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="invoicing_item" columnName="quantity"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />
  <modifyDataType tableName="invoicing_item" columnName="tax"
    newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="invoicing_item" columnName="tax"
    columnDataType="decimal(19,2)" defaultNullValue="0.0" />
  <modifyDataType tableName="invoicing_item" columnName="unit_price"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="invoicing_item" columnName="unit_price"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />

  <modifyDataType tableName="invoicing_transaction" columnName="adjustment"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="invoicing_transaction"
    columnName="adjustment" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="invoicing_transaction"
    columnName="discount_amount" newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="invoicing_transaction"
    columnName="discount_amount" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="invoicing_transaction"
    columnName="discount_percent" newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="invoicing_transaction"
    columnName="discount_percent" columnDataType="decimal(19,2)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="invoicing_transaction" columnName="payment_amount"
    newDataType="decimal(19,6)" />
  <modifyDataType tableName="invoicing_transaction" columnName="shipping_costs"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="invoicing_transaction"
    columnName="shipping_costs" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="invoicing_transaction" columnName="shipping_tax"
    newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="invoicing_transaction"
    columnName="shipping_tax" columnDataType="decimal(19,2)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="invoicing_transaction" columnName="total"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="invoicing_transaction" columnName="total"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />

  <modifyDataType tableName="purchase_invoice" columnName="adjustment"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="purchase_invoice" columnName="adjustment"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice" columnName="discount_amount"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="purchase_invoice"
    columnName="discount_amount" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice" columnName="discount_percent"
    newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="purchase_invoice"
    columnName="discount_percent" columnDataType="decimal(19,2)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice" columnName="payment_amount"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="purchase_invoice"
    columnName="payment_amount" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice" columnName="shipping_costs"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="purchase_invoice"
    columnName="shipping_costs" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice" columnName="shipping_tax"
    newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="purchase_invoice" columnName="shipping_tax"
    columnDataType="decimal(19,2)" defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice" columnName="total"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="purchase_invoice" columnName="total"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />

  <modifyDataType tableName="purchase_invoice_item" columnName="quantity"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="purchase_invoice_item" columnName="quantity"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice_item" columnName="tax"
    newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="purchase_invoice_item" columnName="tax"
    columnDataType="decimal(19,2)" defaultNullValue="0.0" />
  <modifyDataType tableName="purchase_invoice_item" columnName="unit_price"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="purchase_invoice_item"
    columnName="unit_price" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />

  <modifyDataType tableName="sales_item" columnName="quantity"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="sales_item" columnName="quantity"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />
  <modifyDataType tableName="sales_item" columnName="purchase_price"
    newDataType="decimal(19,6)" />
  <modifyDataType tableName="sales_item" columnName="unit_price"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="sales_item" columnName="unit_price"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />
  <modifyDataType tableName="sales_item" columnName="weight"
    newDataType="decimal(19,6)" />

  <modifyDataType tableName="sales_item_pricing" columnName="adjustment"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="sales_item_pricing" columnName="adjustment"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />
  <modifyDataType tableName="sales_item_pricing" columnName="discount_percent"
    newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="sales_item_pricing"
    columnName="discount_percent" columnDataType="decimal(19,2)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="sales_item_pricing" columnName="quantity"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="sales_item_pricing" columnName="quantity"
    columnDataType="decimal(19,6)" defaultNullValue="0.0" />

  <modifyDataType tableName="sales_item_pricing_item" columnName="quantity"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="sales_item_pricing_item"
    columnName="quantity" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="sales_item_pricing_item" columnName="unit_percent"
    newDataType="decimal(19,2)" />
  <addNotNullConstraint tableName="sales_item_pricing_item"
    columnName="unit_percent" columnDataType="decimal(19,2)"
    defaultNullValue="0.0" />
  <modifyDataType tableName="sales_item_pricing_item" columnName="unit_price"
    newDataType="decimal(19,6)" />
  <addNotNullConstraint tableName="sales_item_pricing_item"
    columnName="unit_price" columnDataType="decimal(19,6)"
    defaultNullValue="0.0" />

  <modifyDataType tableName="sel_value" columnName="tax_value"
    newDataType="decimal(19,2)" />
  </changeSet>
</databaseChangeLog>
